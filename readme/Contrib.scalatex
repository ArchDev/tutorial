@import Main._
@import scalaworld.Readme._

@sect{Part 6 - Contrib}
  Scala.meta contrib is a module that provides common utilities for handling
  scala.meta data structures.

  @p
    To use contrib, @code{import scala.meta.contrib._}.

  @p
    Contrib exposes some collection-like methods on @code{Tree}.
    @meta
      source"""
      class A
      trait B
      object C
      object D
      """.find(_.is[Defn.Object])

    @meta
      source"""
      class A
      trait B
      object C {
        val x = 2
        val y = 3
      }
      object D
      """.collectFirst { case q"val y = $body" =>  body.structure }

    @meta
      source"""
      class A
      trait B
      object C {
        val x = 2
        val y = 3
      }
      object D
      """.exists(_.is[Defn.Def])

  @p
    Contrib has a @code{Equal} typeclass for comparing trees by structural or
    syntactic equality.
    @meta
      q"val x = 2".equal[Structurally](q"def x = 2")
    @meta
      q"val x = 2".equal[Structurally]("val x = 2 // comment".parse[Stat].get)
    @meta
      q"val x = 2".equal[Syntactically]("val x = 2 // comment".parse[Stat].get)
    @meta
      q"lazy val x = 2".mods.exists(_.equal[Structurally](mod"lazy"))
    @meta
      q"lazy val x = 2".contains[Structurally](q"3")
    @meta
      q"lazy val x = 2".contains[Structurally](q"2")

  @p
    Contrib has an @code{AssociatedCommments} helper to extract leading
    and trailing comments of tree nodes.
    @meta
      val code: Source = """
      /** This is a docstring */
      trait MyTrait // leading comment
      """.parse[Source].get
      val comments = AssociatedComments(code)
      val myTrait = code.find(_.is[Defn.Trait]).get
      comments.leading(myTrait) -> comments.trailing(myTrait)
